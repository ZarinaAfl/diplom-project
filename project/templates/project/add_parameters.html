{% extends 'project/base.html' %}

{% block content %}

    <div id="params">
        <h3>Добавление дополнительных параметров для интервенции "{{ interv.name }}"</h3>
        <div class="col-xs-12" style="margin-left: 10px;">
            <a href="#" style="font-size: 24px">
                <span class="fas fa-plus add_subparam"></span>
            </a>
        </div>
        <div class="subparam d-block" id="subparam_1">
            <a href="#" class="close delete_subparam" style="color: red;font-size: 34px; " aria-label="Close"
               role="button">&times;</a>
            <div class="row" style="margin-left: 10px;">
                <div class="form-group col-md-5">
                    <label style="font-size: 20px;">Название
                        <input style="font-size: 20px; font-weight: lighter" class="form-control" type="text"
                               id="sub_text">
                    </label>
                </div>
                <div class="form-group col-md-3">
                    <label style="font-size: 20px;">Тип данных
                        <select style="font-size: 20px; font-weight: lighter" class="form-control type_subparam"
                                id="type_subparam">
                            {% for t in types %}
                                <option value="{{ t | first }}">{{ t | last }}</option>
                            {% endfor %}
                        </select>

                    </label>
                </div>
            </div>
        </div>
        <button type="submit" id="submit" class="save btn btn-default">Далее</button>
    </div>
    <div id="result"></div>
    <script>
        $(document).ready(function () {
            $('.container').on('click', '.add_subparam', function () {
                var lastid = $(".subparam:last").attr("id");
                var id = "subparam_" + (Number(lastid.split('_')[1]) + 1);
                $("#" + $("#" + $(this).parent().parent().parent().attr("id") + " .subparam:last").attr("id")).after("<div class=\"subparam d-block\" id=\"" + id + "\"></div>");
                $("#" + id).append("<a href=\"#\" class=\"close delete_subparam\" style=\"color: red;font-size: 34px; \" aria-label=\"Close\"\n" +
                    "                   role=\"button\">&times;</a>\n" +
                    "                <div class=\"row\" style=\"margin-left: 10px;\">\n" +
                    "                    <div class=\"form-group col-md-5\">\n" +
                    "                        <label style=\"font-size: 20px;\">Название\n" +
                    "                            <input style=\"font-size: 20px; font-weight: lighter\" class=\"form-control\" type=\"text\"\n" +
                    "                                   id=\"sub_text\">\n" +
                    "                        </label>\n" +
                    "                    </div>\n" +
                    "                    <div class=\"form-group col-md-3\">\n" +
                    "                        <label style=\"font-size: 20px;\">Тип данных\n" +
                    "                            <select style=\"font-size: 20px; font-weight: lighter\" class=\"form-control type_subparam\"\n" +
                    "                                    id=\"type_subparam\">\n" +
                    "                                {% for t in types %}\n"+
                        "                                    <option value=\"{{ t | first }}\">{{ t | last }}</option>\n"
                        +
                        "                                {% endfor %}\n" +
                    "                            </select>\n" +
                    "\n" +
                    "                        </label>\n" +
                    "                    </div>\n" +
                    "                </div>\n" +
                    "                <div class=\"row\" style=\"margin-left: 10px;\">\n" +
                    "                    <div class=\"form-row drop_down_list\" hidden>\n" +
                    "                        <div class=\"form-group col-md-6\">\n" +
                    "                            <label style=\"font-size: 20px;\">Выберите необходимый список\n" +
                    "                                <select style=\"font-size: 20px; font-weight: lighter\" class=\"form-control\"\n" +
                    "                                        id=\"enum_subparam\">\n" +
                    "                                    {% for e in enums %}\n"+
                        "                                        <option value=\"{{ e.id }}\">{{ e.name }}</option>\n"+
                        "                                    {% endfor %}\n" +
                    "                                </select>\n" +
                    "                            </label>\n" +
                    "                        </div>\n" +
                    "                    </div>\n" +
                    "                </div>\n" +
                    "                <div class=\"row\" style=\"margin-left: 10px;\">\n" +
                    "                </div>");

            });

            $(".container").on('click', '#submit', function () {
                var subparams = $(".subparam");
                var data_subparams = [];
                for (j = 0; j < subparams.length; j++) {
                    var tmp = {
                        "name": $(subparams[j]).find("#sub_text").val(),
                        "type_subparam": $(subparams[j]).find("#type_subparam").val(),
                    };
                    data_subparams.push(tmp);
                }
                var result = {"subparams": data_subparams, csrfmiddlewaretoken: '{{ csrf_token }}'};
                $.ajax({
                    type: "post",
                    data: result,
                    success: function (response) {
                        window.location = "http://127.0.0.1:8000/intervention/".concat({{ interv.pk }}).concat("/fill_params");
                    }
                });
            });

        });
    </script>

{% endblock %}